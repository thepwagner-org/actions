name: Build
on:
  workflow_call:
    inputs:
      image:
        required: true
        type: string
    secrets:
      # Don't pass ${{secrets.GITHUB_TOKEN}}, as we want Actions to trigger on push
      not_github_token:
        required: true      

# Documentation only: the caller defines permission
permissions:
  contents: write 
  actions: write
  pull-requests: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: "ðŸŒŽ Fetching code"
        uses: actions/checkout@a12a3943b4bdde767164f792f33f40b04645d846 # tag=v3
        with:
          fetch-depth: 0
          persist-credentials: false
      - name: "ðŸŒŽ Logging in to Docker Registry"
        uses: docker/login-action@dd4fa0671be5250ee6f50aedf4cb05514abda2c7 # tag=v1
        with:
          registry: ghcr.io
          username: ${{github.repository_owner}}
          password: ${{secrets.not_github_token}}

      - name: "ðŸš§ Building image"
        run: docker build -t ghcr.io/${{github.repository}}:${{github.sha}} .
